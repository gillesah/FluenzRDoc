---
title: Webhooks
description: Recibe notificaciones en tiempo real sobre eventos de FluenzR.
---

# Webhooks

Los webhooks te permiten recibir notificaciones en tiempo real cuando ocurren eventos en FluenzR.

> **Información**
Los webhooks solo están disponibles en el plan **Pro**.

## Cómo funciona

1. Configuras una URL de webhook en FluenzR
2. Cuando ocurre un evento, FluenzR envía una solicitud HTTP POST a tu URL
3. Tu servidor procesa el evento y responde con un código 2xx

## Eventos disponibles

### Contactos

| Evento | Descripción |
|--------|-------------|
| `contact.created` | Nuevo contacto creado |
| `contact.updated` | Contacto actualizado |
| `contact.deleted` | Contacto eliminado |

### Campañas

| Evento | Descripción |
|--------|-------------|
| `campaign.started` | Campaña iniciada |
| `campaign.paused` | Campaña pausada |
| `campaign.completed` | Campaña completada |

### Correos

| Evento | Descripción |
|--------|-------------|
| `email.sent` | Correo enviado |
| `email.delivered` | Correo entregado |
| `email.opened` | Correo abierto |
| `email.clicked` | Enlace clicado |
| `email.replied` | Respuesta recibida |
| `email.bounced` | Rebote detectado |
| `email.unsubscribed` | Baja |

## Crear un webhook

### Vía la interfaz

1. Ve a **Configuración** > **Webhooks**
2. Haz clic en **+ Nuevo webhook**
3. Configura la URL y los eventos
4. Guarda

### Vía la API

```
POST /webhooks
```

```json
{
  "url": "https://tu-servidor.com/webhooks/fluenzr",
  "events": [
    "email.sent",
    "email.opened",
    "email.replied"
  ],
  "secret": "tu_secreto_webhook"
}
```

### Ejemplo

```bash
curl -X POST "https://api.fluenzr.co/v1/webhooks" \
  -H "Authorization: Bearer flz_sk_xxx" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://tu-servidor.com/webhooks/fluenzr",
    "events": ["email.opened", "email.replied"],
    "secret": "whsec_abc123"
  }'
```

### Respuesta

```json
{
  "success": true,
  "data": {
    "id": "whk_abc123",
    "url": "https://tu-servidor.com/webhooks/fluenzr",
    "events": ["email.opened", "email.replied"],
    "status": "active",
    "createdAt": "2025-01-15T10:30:00Z"
  }
}
```

## Formato de payload

### Estructura general

```json
{
  "id": "evt_abc123",
  "type": "email.opened",
  "timestamp": "2025-01-15T14:32:00Z",
  "data": {
    // Datos específicos del evento
  }
}
```

### email.sent

```json
{
  "id": "evt_abc123",
  "type": "email.sent",
  "timestamp": "2025-01-15T10:00:00Z",
  "data": {
    "campaignId": "cmp_xyz789",
    "campaignName": "Prospección Q1",
    "contactId": "con_def456",
    "contactEmail": "juan@example.com",
    "emailNodeId": "node_2",
    "emailSubject": "Juan, pregunta rápida"
  }
}
```

### email.opened

```json
{
  "id": "evt_abc124",
  "type": "email.opened",
  "timestamp": "2025-01-15T14:32:00Z",
  "data": {
    "campaignId": "cmp_xyz789",
    "contactId": "con_def456",
    "contactEmail": "juan@example.com",
    "emailNodeId": "node_2",
    "openCount": 1,
    "firstOpen": true,
    "userAgent": "Mozilla/5.0...",
    "ip": "192.168.1.1"
  }
}
```

### email.clicked

```json
{
  "id": "evt_abc125",
  "type": "email.clicked",
  "timestamp": "2025-01-15T14:35:00Z",
  "data": {
    "campaignId": "cmp_xyz789",
    "contactId": "con_def456",
    "contactEmail": "juan@example.com",
    "emailNodeId": "node_2",
    "linkUrl": "https://fluenzr.co/demo",
    "clickCount": 1
  }
}
```

### email.replied

```json
{
  "id": "evt_abc126",
  "type": "email.replied",
  "timestamp": "2025-01-15T15:10:00Z",
  "data": {
    "campaignId": "cmp_xyz789",
    "contactId": "con_def456",
    "contactEmail": "juan@example.com",
    "emailNodeId": "node_2",
    "replySubject": "Re: Juan, pregunta rápida",
    "replyPreview": "Hola, estaría interesado en..."
  }
}
```

### email.bounced

```json
{
  "id": "evt_abc127",
  "type": "email.bounced",
  "timestamp": "2025-01-15T10:05:00Z",
  "data": {
    "campaignId": "cmp_xyz789",
    "contactId": "con_def456",
    "contactEmail": "juan@example.com",
    "bounceType": "hard",
    "bounceReason": "Usuario desconocido"
  }
}
```

### contact.created

```json
{
  "id": "evt_abc128",
  "type": "contact.created",
  "timestamp": "2025-01-15T09:00:00Z",
  "data": {
    "contact": {
      "id": "con_def456",
      "email": "juan@example.com",
      "firstName": "Juan",
      "lastName": "Pérez",
      "company": "Acme Corp"
    }
  }
}
```

## Verificación de firma

Cada webhook incluye una firma para verificar su autenticidad.

### Encabezados

```
X-FluenzR-Signature: sha256=abc123...
X-FluenzR-Timestamp: 1640000000
```

### Verificación (Node.js)

```javascript
const crypto = require('crypto');

function verifyWebhookSignature(payload, signature, timestamp, secret) {
  const expectedSignature = crypto
    .createHmac('sha256', secret)
    .update(`${timestamp}.${payload}`)
    .digest('hex');

  return `sha256=${expectedSignature}` === signature;
}

// En tu endpoint
app.post('/webhooks/fluenzr', (req, res) => {
  const signature = req.headers['x-fluenzr-signature'];
  const timestamp = req.headers['x-fluenzr-timestamp'];
  const payload = JSON.stringify(req.body);

  if (!verifyWebhookSignature(payload, signature, timestamp, WEBHOOK_SECRET)) {
    return res.status(401).send('Firma inválida');
  }

  // Procesar el evento
  const event = req.body;
  console.log(`Evento recibido: ${event.type}`);

  res.status(200).send('OK');
});
```

### Verificación (Python)

```python
import hmac
import hashlib

def verify_webhook_signature(payload, signature, timestamp, secret):
    expected = hmac.new(
        secret.encode(),
        f"{timestamp}.{payload}".encode(),
        hashlib.sha256
    ).hexdigest()

    return f"sha256={expected}" == signature

# En tu endpoint Flask
@app.route('/webhooks/fluenzr', methods=['POST'])
def handle_webhook():
    signature = request.headers.get('X-FluenzR-Signature')
    timestamp = request.headers.get('X-FluenzR-Timestamp')
    payload = request.get_data(as_text=True)

    if not verify_webhook_signature(payload, signature, timestamp, WEBHOOK_SECRET):
        return 'Firma inválida', 401

    event = request.get_json()
    print(f"Evento recibido: {event['type']}")

    return 'OK', 200
```

## Gestión de reintentos

FluenzR reintenta automáticamente los webhooks fallidos:

| Intento | Retraso |
|---------|---------|
| 1 | Inmediato |
| 2 | 1 minuto |
| 3 | 5 minutos |
| 4 | 30 minutos |
| 5 | 2 horas |

Después de 5 fallos, el webhook se marca como "failed".

### Códigos de éxito

Tu servidor debe responder con un código HTTP 2xx en 30 segundos.

| Código | Resultado |
|--------|-----------|
| 200-299 | Éxito |
| 3xx | Reintentar |
| 4xx | Fallo permanente |
| 5xx | Reintentar |
| Timeout | Reintentar |

## Gestionar webhooks

### Listar webhooks

```
GET /webhooks
```

### Actualizar un webhook

```
PUT /webhooks/:id
```

```json
{
  "events": ["email.opened", "email.replied", "email.clicked"]
}
```

### Eliminar un webhook

```
DELETE /webhooks/:id
```

### Probar un webhook

```
POST /webhooks/:id/test
```

Envía un evento de prueba a tu URL.

### Ver logs

```
GET /webhooks/:id/logs
```

Recupera el historial de intentos de entrega.

```json
{
  "success": true,
  "data": [
    {
      "id": "log_abc123",
      "eventId": "evt_xyz789",
      "eventType": "email.opened",
      "status": "delivered",
      "statusCode": 200,
      "responseTime": 145,
      "timestamp": "2025-01-15T14:32:00Z"
    }
  ]
}
```

## Buenas prácticas

### Responder rápidamente

Tu endpoint debe responder en menos de 30 segundos. Procesa en segundo plano si es necesario.

### Idempotencia

Tu código debe manejar eventos duplicados. Usa el ID del evento para deduplicar.

### Monitoreo

Supervisa tus webhooks:
- Tasa de éxito
- Tiempo de respuesta
- Errores frecuentes

### Seguridad

- Siempre verifica la firma
- Usa solo HTTPS
- Valida el timestamp (rechazar si > 5 minutos)
